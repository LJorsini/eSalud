@{
  ViewData["Title"] = "Estudios";
}

@{
  ViewData["Title"] = "Medicos";
}
<link rel="stylesheet" href="~/css/estudios.css" asp-append-version="true" />
<h1>Estudios</h1>

<div class="card">

  <div class="card-header row">
    <div class="col-6 d-flex align-items-center">
      <input type="search" class="form-control rounded" placeholder="Estudios" aria-label="Search"
        aria-describedby="search-addon" />
      <button type="button" class="btn btn-primary ms-4 d-flex align-items-center justify-content-center"
        data-bs-toggle="modal" data-bs-target="#modalEstudios"><i class="material-icons">add</i></button>
      <button type="button" class="btn btn-primary ms-4 d-flex align-items-center justify-content-center"
        onclick="Imprimir()"><i class="material-icons">print</i></button>
    </div>

  </div>

  <div class="card-body">
    <table id="tablaEstudios" class="table">
      <thead>
        <tr>
          <th scope="col">PCIENTE</th>
          <th scope="col">PROFESIONAL</th>
          <th scope="col">OBRA SOCIAL</th>
          <th scope="col">ESTUDIO</th>

        </tr>
      </thead>
      <tbody>
        <tr>
          <th>JUAN PEREZ</th>
          <td>123456</td>
          <td>C205</td>
          <td><button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
              data-bs-target="#modalMostrarEstudios">VER</button></td>

        </tr>
        <tr>
          <th>CHIQUI TAPIA</th>
          <td>11458789</td>
          <td>10254</td>
          <td><button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
              data-bs-target="#modalMostrarEstudios">VER</button></td>

        </tr>
        <tr>
          <th>PEDRO PEDRO</th>
          <td>37225488</td>
          <td>1520</td>
          <td><button type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
              data-bs-target="#modalMostrarEstudios">VER</button></td>

        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="modalEstudios" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">NUEVO ESTUDIO</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><b>Los datos que tienen un * son obligatorios.</b></p>
        <form class="needs-validation" novalidate>
          <div class="row">

            <div class="mb-3 col-4">
              <label for="paciente" class="form-label fw-bold">PACIENTE *</label>
              <select id="localidad" class="form-select" aria-label="Default select example" required>
                <option selected disabled value="">[SELECCIONAR]</option>
                <option value="1">JUAN PEREZ</option>
                <option value="2">CHIQUI TAPIA</option>
                <option value="3">CINDY GORY</option>
              </select>
              <div class="invalid-feedback">
                *Debe ingresar un paciente.
              </div>
            </div>

            <div class="mb-3 col-4">
              <label for="profesional" class="form-label fw-bold">PROFESIONAL *</label>
              <select id="profesional" class="form-select" aria-label="Default select example" required>
                <option selected disabled value="">[SELECCIONAR]</option>
                <option value="1">JUAN PEREZ</option>
                <option value="2">CHIQUI TAPIA</option>
                <option value="3">CINDY GORY</option>
              </select>
              <div class="invalid-feedback">
                *Debe ingresar un profesional.
              </div>
            </div>

            <div class="mb-3 col-4">
              <label for="obraSocial" class="form-label fw-bold">OBRA SOCIAL *</label>
              <select id="obraSocial" class="form-select" aria-label="Default select example" required>
                <option selected disabled value="">[SELECCIONAR]</option>
                <option value="1">SANCOR</option>
                <option value="2">SWISH MEDICAL</option>
                <option value="2">NO TIENE</option>

              </select>
              <div class="invalid-feedback">
                *Debe ingresar una obra social.
              </div>
            </div>

            <div class="row">
              <div class="mb-3 col-4">
                <label for="fechaEstudio" class="form-label fw-bold">FECHA DEL ESTUDIO *</label>
                <input type="date" class="form-control" id="fechaEstudio" placeholder="" oninput="textoMayuscula(this)"
                  required>
                <div class="invalid-feedback">
                  *Debe ingresar la fecha.
                </div>
              </div>

            </div>


          </div>

          <div class="row">
            <div class="input-group mb-3">
              <label class="input-group-text" for="inputGroupFile01">Subir Archivo</label>
              <input type="file" class="form-control" id="inputGroupFile01" required>
              <div class="invalid-feedback">
                  *Debe ingresar una imagen.
                </div>
            </div>
          </div>

          <div class="row">
            <div class="input-group">
              <span class="input-group-text">OBSERVACIONES</span>
              <textarea class="form-control" aria-label="With textarea" required></textarea>
            </div>
            <div class="invalid-feedback">
                  *Debe ingresar la fecha.
                </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary" onclick="GuardarEstudio()">Guardar</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<!-- Modal informe-->
<div class="modal fade" id="modalMostrarEstudios" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">ESTUDIOS</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="imagen">
          @* <img src="~/img/radiografia.jpg" alt="Radiografía"
            style="width: 300px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px;"> *@
          <div class="report-container"
            style="padding: 20px; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; max-width: 600px; margin: auto;">
            <h2 style="text-align: center; font-size: 24px; color: #333;">Informe Radiológico de Radiografía de Tórax
            </h2>

            <h3 style="font-size: 18px; color: #555;">1. Datos Generales del Paciente</h3>
            <ul style="list-style: none; padding: 0;">
              <li><strong>Nombre:</strong> JUAN PEREZ</li>
              <li><strong>Edad:</strong> 35</li>
              <li><strong>Sexo:</strong> Masculino</li>
              <li><strong>Fecha del Examen:</strong> 30/09/2024</li>
              <li><strong>Tipo de Examen:</strong> Radiografía de Tórax</li>
            </ul>

            <h3 style="font-size: 18px; color: #555;">2. Proyección</h3>
            <p><strong>Proyecciones realizadas:</strong> AP</p>

            <h3 style="font-size: 18px; color: #555;">3. Técnica Radiológica</h3>
            <p><strong>Calidad de la Imagen:</strong> Deficiente</p>
            <p><strong>Posición del Paciente:</strong> Otro</p>
            <p><strong>Observaciones Técnicas:</strong> Ninguna</p>

            <h3 style="font-size: 18px; color: #555;">4. Hallazgos</h3>
            <ul style="list-style: none; padding: 0;">
              <li><strong>Parénquima Pulmonar:</strong> No</li>
              <li><strong>Espacio Pleural:</strong> No</li>
              <li><strong>Corazón y Mediastino:</strong> No</li>
              <li><strong>Diafragma:</strong> No</li>
              <li><strong>Vasos Pulmonares:</strong> No</li>
              <li><strong>Tejidos Blandos y Estructuras Óseas:</strong> No</li>
            </ul>

            <h3 style="font-size: 18px; color: #555;">5. Impresión Diagnóstica</h3>
            <p>Ninguna</p>

            <h3 style="font-size: 18px; color: #555;">6. Recomendaciones</h3>
            <p>Ninguna</p>

            <h3 style="font-size: 18px; color: #555;">7. Observaciones</h3>
            <p>Ninguna</p>

            <p style="text-align: center; font-size: 16px; color: #333;"><strong>Conclusión:</strong> Resumen final de
              los hallazgos</p>
          </div>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary ms-4 d-flex align-items-center justify-content-center"
            onclick="ImprimirInforme()"><i class="material-icons">print</i></button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">CERRAR</button>

        </div>
      </div>
    </div>



    @section Scripts {
      <script src="~/js/estudios-1.0.0.js"></script>

      <script>
        function Imprimir() {
          var doc = new jsPDF();
          //var doc = new jsPDF('l', 'mm', [297, 210]);

          var totalPagesExp = "{total_pages_count_string}";
          var pageContent = function (data) {

            var pageHeight = doc.internal.pageSize.height || doc.internal.pageSize.getHeight();
            var pageWidth = doc.internal.pageSize.width || doc.internal.pageSize.getWidth();

            // FOOTER
            var str = "Pagina " + data.pageCount;
            // Total page number plugin only available in jspdf v1.0+
            if (typeof doc.putTotalPages == 'function') {
              str = str + " de " + totalPagesExp;
            }

            doc.setLineWidth(8);
            doc.setDrawColor(13, 110, 253);
            doc.line(14, pageHeight - 11, 196, pageHeight - 11);

            doc.setFontSize(10);


            doc.setFontStyle('bold');

            doc.text(str, 17, pageHeight - 10);

          };


          var elem = document.getElementById("tablaEstudios");
          var res = doc.autoTableHtmlToJson(elem);
          doc.autoTable(res.columns, res.data,
            {
              addPageContent: pageContent,
              theme: 'grid',
              headStyles: { fillColor: [13, 110, 253] },
              //styles: { fillColor: [13, 10, 253] }, //COLOR ENCABEZADO
              columnStyles: {
                0: {
                  halign: 'center',
                  cellWidth: 'auto',
                  fontSize: 7,
                  //fillColor: [0, 255, 0] 
                },
                1: { fontSize: 7, overflow: 'hidden' },
                5: {
                  halign: 'center',
                  cellWidth: 'auto',
                  fontSize: 7,
                  //fillColor: [13, 10, 253] 
                },
                6: {
                  halign: 'center',
                  cellWidth: 'auto',
                  fontSize: 7,
                  //fillColor: [0, 255, 0] 
                },

              }, // Celdas de la primera columna centradas y verdes
              margin: { top: 10 },
            }
          );

          // ESTO SE LLAMA ANTES DE ABRIR EL PDF PARA QUE MUESTRE EN EL PDF EL NRO TOTAL DE PAGINAS. ACA CALCULA EL TOTAL DE PAGINAS.
          if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages(totalPagesExp);
          }

          //doc.save('InformeSistema.pdf')

          var string = doc.output('datauristring');
          var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>"

          var x = window.open();
          x.document.open();
          x.document.write(iframe);
          x.document.close();
        }
      </script>

      <script>


        function ImprimirInforme() {
          var doc = new jsPDF();
          var totalPagesExp = "{total_pages_count_string}";

          // Configuración del pie de página
          var pageContent = function (data) {
            var pageHeight = doc.internal.pageSize.height || doc.internal.pageSize.getHeight();
            var str = "Página " + data.pageCount;

            if (typeof doc.putTotalPages == 'function') {
              str = str + " de " + totalPagesExp;
            }

            doc.setLineWidth(8);
            doc.setDrawColor(13, 110, 253);
            doc.line(14, pageHeight - 11, 196, pageHeight - 11);

            doc.setFontSize(10);
            doc.setFontStyle('bold');
            doc.text(str, 17, pageHeight - 10);
          };



          // Añadir contenido del informe
          doc.setFontSize(14);
          doc.setFontStyle('bold');
          doc.text("Informe Radiológico de Radiografía de Tórax", 105, 70, null, null, "center");

          doc.setFontSize(10);
          doc.setFontStyle('normal');
          doc.text("1. Datos Generales del Paciente", 15, 85);
          doc.text("Nombre: JUAN PEREZ", 15, 90);
          doc.text("Edad: 35", 15, 95);
          doc.text("Sexo: Masculino", 15, 100);
          doc.text("Fecha del Examen: 30/09/2024", 15, 105);
          doc.text("Tipo de Examen: Radiografía de Tórax", 15, 110);

          doc.text("2. Proyección", 15, 120);
          doc.text("Proyecciones realizadas: AP", 15, 125);

          doc.text("3. Técnica Radiológica", 15, 135);
          doc.text("Calidad de la Imagen: Deficiente", 15, 140);
          doc.text("Posición del Paciente: Otro", 15, 145);
          doc.text("Observaciones Técnicas: Ninguna", 15, 150);

          doc.text("4. Hallazgos", 15, 160);
          doc.text("Parénquima Pulmonar: No", 15, 165);
          doc.text("Espacio Pleural: No", 15, 170);
          doc.text("Corazón y Mediastino: No", 15, 175);
          doc.text("Diafragma: No", 15, 180);
          doc.text("Vasos Pulmonares: No", 15, 185);
          doc.text("Tejidos Blandos y Estructuras Óseas: No", 15, 190);

          doc.text("5. Impresión Diagnóstica", 15, 200);
          doc.text("Ninguna", 15, 205);

          doc.text("6. Recomendaciones", 15, 215);
          doc.text("Ninguna", 15, 220);

          doc.text("7. Observaciones", 15, 230);
          doc.text("Ninguna", 15, 235);

          doc.setFontSize(12);
          doc.text("Conclusión:", 15, 245);
          doc.setFontSize(10);
          doc.text("Resumen final de los hallazgos", 15, 250);

          // Calcula el total de páginas
          if (typeof doc.putTotalPages === 'function') {
            doc.putTotalPages(totalPagesExp);
          }

          // Mostrar PDF en un iframe
          var string = doc.output('datauristring');
          var iframe = "<iframe width='100%' height='100%' src='" + string + "'></iframe>";

          var x = window.open();
          x.document.open();
          x.document.write(iframe);
          x.document.close();
        }


      </script>

      <script>
  // Función para establecer la fecha actual en el campo de fecha
  function setFechaActual() {
    const fechaEstudio = document.getElementById('fechaEstudio');
    const hoy = new Date();
    const dia = String(hoy.getDate()).padStart(2, '0');
    const mes = String(hoy.getMonth() + 1).padStart(2, '0'); // Enero es 0
    const anio = hoy.getFullYear();
    fechaEstudio.value = `${anio}-${mes}-${dia}`;
  }

  // Ejecutar la función cuando la página se carga
  document.addEventListener('DOMContentLoaded', setFechaActual);
</script>

      
    }